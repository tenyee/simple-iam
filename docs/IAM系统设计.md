# 第一章 功能介绍与系统架构

## 1.1 功能示意

IAM 系统可以帮用户解决的问题是：在特定的条件下，谁能够 / 不能够对哪些资源做哪些操作（Who is able to do what on something given some context），也即完成资源授权功能

![image-20220113222854507](D:\tenyee\go_lib_path\src\github.com\tenyee\simple-iam\docs\imags\系统示意图.png)

1. 用户通过提供昵称、密码、邮箱、电话等信息注册并登录到IAM系统上，这里以用户名以及密码作为唯一的身份标识来访问IAM系统，并且完成认证；
2. 用户为自己创建密钥资源（`secretID/secretKey`），用于访问IAM的资源授权服务时认证身份；
3. IAM通过授权策略完成授权，需要用户在IAM中创建授权策略；
4. 请求IAM提供的授权接口，IAM会根据用户的请求内容和授权策略来决定一个授权请求是否被允许；



IAM系统用到3种系统资源：用户（User），密钥(Secret)和策略(Policy)，其映射到RESTful资源：

1. 用户(User)：实现对用户的增、删、改、查、修改密码、批量修改等操作；
2. 密钥(Secret)：实现对密钥的增、删、改、查操作；
3. 策略(Policy)：实现对策的增、删、改、查、批量删除操作。



## 1.2 系统架构

![image-20220113225710245](D:\tenyee\go_lib_path\src\github.com\tenyee\simple-iam\docs\imags\系统架构.png)

**备注：**为了确保通信安全，客户端访问服务端都是通过 HTTPS 协议来访问的。



| 序号 | 分类     | 组件             | 功能说明                                                     |
| ---- | -------- | ---------------- | ------------------------------------------------------------ |
| 1    | 核心组件 | iam-apiserver    | 通过RESTful API完成用户，密钥和策略的删改查                  |
| 2    | 核心组件 | iam-authz-server | 授权服务，从iam-apiserver拉取密钥和授权策略，并缓存在内存中，用户通过请求iam-authz-server提供的/v1/authz接口来完成资源授权，接口会查询缓存的授权策略，根据策略决定授权是否通过，同时也会把授权日志上报到redis中 |
| 3    | 核心组件 | iam-pump         |                                                              |
| 4    | 核心组件 |                  |                                                              |
| 5    | 核心组件 |                  |                                                              |
| 6    |          |                  |                                                              |
| 7    |          |                  |                                                              |
| 8    |          |                  |                                                              |

iam-pump 组件异步消费 Redis 中的数据，并持久化存储在 MongoDB 中，供 iam-operating-system 运营平台展示。



## 1.3 软件架构模式

​	采用前后端分离模式， 让前后端通过 RESTful API 通信会带来以下 5 点好处：

- 可以让前、后端人员各自专注在自己业务的功能开发上，让专业的人做专业的事，来提高代码质量和开发效率
- 前后端可并行开发和发布，这也能提高开发和发布效率，加快产品迭代速度
- 前后端组件、代码分开，职责分明，可以增加代码的维护性和可读性，减少代码改动引起的 Bug 概率，同时也能快速定位 Bug
- 前端 JavaScript 可以处理后台的数据，减少对后台服务器的压力
- 可根据需要选择性水平扩容前端或者后端来节约成本







# 第二章 接口定义





# 第三章 服务构建




# 第四章 基础组件

